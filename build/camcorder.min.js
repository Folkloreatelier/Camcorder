/**
 * @license almond 0.2.9 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
    Underscore.js templates as a standalone implementation. 
    JavaScript micro-templating, similar to John Resig's implementation. 
    Underscore templates documentation: http://documentcloud.github.com/underscore/#template
    Modifyed by Martin Lundgren
*/

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

(function(e,t){typeof define=="function"&&define.amd?define([],t):e.Camcorder=t()})(this,function(){var e,t,n;return function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../bower_components/almond/almond",function(){}),function(){var e={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},t=/.^/,n={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var r in n)n[n[r]]=r;var i=/\\|'|\r|\n|\t|\u2028|\u2029/g,s=/\\(\\|'|r|n|t|u2028|u2029)/g,o=function(r,s,o){e.variable=o;var u="__p+='"+r.replace(i,function(e){return"\\"+n[e]}).replace(e.escape||t,function(e,t){return"'+\n_.escape("+unescape(t)+")+\n'"}).replace(e.interpolate||t,function(e,t){return"'+\n("+unescape(t)+")+\n'"}).replace(e.evaluate||t,function(e,t){return"';\n"+unescape(t)+"\n;__p+='"})+"';\n";e.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+u+"return __p;\n";var a=new Function(e.variable||"obj",u);if(s)return a(s);var f=function(e){return a.call(this,e)};return f.source="function("+(e.variable||"obj")+"){\n"+u+"}",f};window.tmpl=o}(),n("template",function(e){return function(){var t,n;return t||e.tmpl}}(this)),function(){var e=function(){};e.prototype={constructor:e,apply:function(t){t.on=$.proxy(e.prototype.on,t),t.hasEvent=$.proxy(e.prototype.hasEvent,t),t.off=$.proxy(e.prototype.off,t),t.trigger=$.proxy(e.prototype.trigger,t)},on:function(e,t){this._listeners===undefined&&(this._listeners={});var n=this._listeners;n[e]===undefined&&(n[e]=[]),$.inArray(t,n[e])===-1&&n[e].push(t)},hasEvent:function(e,t){if(this._listeners===undefined)return!1;var n=this._listeners;return n[e]!==undefined&&$.inArray(t,n[e])!==-1?!0:!1},off:function(e,t){if(this._listeners===undefined)return;var n=this._listeners,r=n[e];if(r!==undefined){var i=$.inArray(t,r);i!==-1&&r.splice(i,1)}},trigger:function(e){if(this._listeners===undefined)return;var t=this._listeners,n=t[e],r=[];if(arguments.length>1)for(var i=1,s=arguments.length;i<s;i++)r.push(arguments[i]);if(n!==undefined){var o=[],u=n.length;for(var i=0;i<u;i++)o[i]=n[i];for(var i=0;i<u;i++)o[i].apply(this,r)}}},window.EventDispatcher=e}(),n("eventdispatcher",function(e){return function(){var t,n;return t||e.EventDispatcher}}(this)),n("text",["module"],function(e){var n,r,i,s,o,u=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,f=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l=typeof location!="undefined"&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,p=l&&(location.port||undefined),d={},v=e.config&&e.config()||{};n={version:"2.0.12",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(f);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:v.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=u[t];try{e=new ActiveXObject(n)}catch(r){}if(e){u=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,i){var s,o,u,a=n.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===t)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,t,r,i){r=t?n.strip(r):r,v.isBuild&&(d[e]=r),i(r)},load:function(e,t,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}v.isBuild=i&&i.isBuild;var s=n.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=t.toUrl(o),a=v.useXhr||n.useXhr;if(u.indexOf("empty:")===0){r();return}!l||a(u,c,h,p)?n.get(u,function(t){n.finishLoad(e,s.strip,t,r)},function(e){r.error&&r.error(e)}):t([o],function(e){n.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,t,r,i){if(d.hasOwnProperty(t)){var s=n.jsEscape(d[t]);r.asModule(e+"!"+t,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,t,r,i,s){var o=n.parseName(t),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";n.load(a,r,function(t){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},n.write(e,a,r,s)},s)}};if(v.env==="node"||!v.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])r=t.nodeRequire("fs"),n.get=function(e,t,n){try{var i=r.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){n&&n(s)}};else if(v.env==="xhr"||!v.env&&n.createXhr())n.get=function(e,t,r,i){var s=n.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);v.onXhr&&v.onXhr(s,e),s.onreadystatechange=function(n){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):t(s.responseText),v.onXhrComplete&&v.onXhrComplete(s,e))},s.send(null)};else if(v.env==="rhino"||!v.env&&typeof Packages!="undefined"&&typeof java!="undefined")n.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(v.env==="xpconnect"||!v.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)i=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in i,n.get=function(e,t){var n,r,u,a={};o&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),n.init(u,1,0,!1),r=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(n,"utf-8",n.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(n.available(),a),r.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return n}),n("text!lib/templates/embed.html",[],function(){return'<div id="<%= id %>"></div>'}),n("lib/camcorder",["template","eventdispatcher","text!lib/templates/embed.html"],function(e,t,n){function r(t,i){this.el=$(t),this.options=$.extend({mode:r.MODE_RECORD,recordId:null,debugMode:!0,volume:1,serverURL:"rtmp://localhost/camcorder",flashVersion:"auto",swf:"swf/",expressInstall:"expressInstall.swf",template:e(n),params:{wmode:"window",menu:"false",allowScriptAccess:"always",allowFullScreen:"false"},flashVars:{}},i),this.mode=this.options.mode,this.uniqueId="camcorder_"+(new Date).getTime(),this.recordId=this.options.recordId||this.uniqueId,this.callbackName=this.uniqueId+"_listener",this._flash=null,this.recording=!1,this.playing=!1,this.paused=!1,window[this.callbackName]=$.proxy(this._handleFlashCallback,this),this.options.flashVersion==="auto"&&this.detectFlashVersion(),this.init()}return t.prototype.apply(r.prototype),r.isSupported=function(){return swfobject.hasFlashPlayerVersion("9.0.0")?!0:!1},r.MODE_RECORD="record",r.MODE_PLAYBACK="playback",r.prototype.detectFlashVersion=function(){swfobject.hasFlashPlayerVersion("11.0.0")?this.options.flashVersion=11:swfobject.hasFlashPlayerVersion("9.0.0")&&(this.options.flashVersion=9)},r.prototype.init=function(){this._embedSWF()},r.prototype.record=function(){this._flash.record()},r.prototype.stop=function(){this._flash.stop()},r.prototype.play=function(){this._flash.play()},r.prototype.pause=function(){this._flash.pause()},r.prototype.seek=function(e){this._flash.seek(e)},r.prototype.getCurrentTime=function(){return this._flash.getCurrentTime()},r.prototype.setMode=function(e){this.mode=e,this._flash.setMode(e),this.playing=!1,this.recording=!1,this.paused=!1},r.prototype.setRecordId=function(e){this.recordId=e,this._flash.setRecordId(e)},r.prototype.setVolume=function(e){this._flash.setVolume(e),this.options.volume=e},r.prototype.mute=function(){this._flash.setVolume(0)},r.prototype.unmute=function(){this._flash.setVolume(this.options.volume)},r.prototype.getMicrophoneActivity=function(){return this._flash.getMicrophoneActivity()},r.prototype.getMicrophoneIntensity=function(){return this._flash.getMicrophoneIntensity()},r.prototype.setSpectrumRadius=function(e){this._flash.setSpectrumRadius(e)},r.prototype.setSpectrumNoise=function(e){this._flash.setSpectrumNoise(e)},r.prototype.setSpectrumPoints=function(e){this._flash.setSpectrumPoints(e)},r.prototype.snapshot=function(){return this._flash.snapshot()},r.prototype.destroy=function(){this.off(),this.el.find("#"+this.uniqueId).remove(),window[this.callbackName]=null},r.prototype._embedSWF=function(){var e=this.options.template({id:this.uniqueId}),t=$(e);this.el.append(t);var n=$.extend({mode:this.mode,serverURL:this.options.serverURL,jsCallback:this.callbackName,recordId:this.recordId,debugMode:this.options.debugMode?"true":"false"},this.options.flashVars),r=this.options.params,i={id:this.uniqueId},s=this.options.swf.replace(/\/?$/,"/"),o=s+"camcorder.swf",u=s+this.options.expressInstall,a=this.el.find("#"+this.uniqueId)[0];swfobject.embedSWF(o,a,"100%","100%","9.0.0",u,n,r,i,$.proxy(this._handleFlashReady,this))},r.prototype._handleFlashReady=function(e){e.success?this._flash=swfobject.getObjectById(e.id):(this._flash=null,this.trigger("error"))},r.prototype._handleFlashCallback=function(e,t){switch(e){case"record.start":this.recording=!0,this.playing=!1,this.paused=!1;break;case"record.stop":this.recording=!1,this.paused=!1;break;case"record.pause":this.recording=!0,this.paused=!0;break;case"playback.play":this.recording=!1,this.playing=!0,this.paused=!1;break;case"playback.pause":this.recording=!1,this.paused=!0;break;case"playback.stop":this.recording=!1,this.paused=!1;break;case"playback.ended":this.recording=!1,this.paused=!1}window.setTimeout($.proxy(function(){this.trigger(e,t)},this),1)},r}),t.config({baseUrl:"/javascript",paths:{text:"../bower_components/requirejs-text/text",template:"vendors/template",eventdispatcher:"vendors/EventDispatcher"},shim:{template:{exports:"tmpl"},eventdispatcher:{exports:"EventDispatcher"}}}),n("main",["lib/camcorder"],function(e){return e}),t("main")});